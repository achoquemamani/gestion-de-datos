-- Ac√° van los create de los procedures y los EXEC de ellos


---SAMU

GO
CREATE PROCEDURE HARAKIRI.RELLENAR_TABLA_DESCUENTO_COMPRA
AS
BEGIN
INSERT INTO HARAKIRI.DESCUENTO_COMPRA (COMPRA_NUMERO, DESCUENTO_COMPRA_VALOR )
SELECT DISTINCT 
        M.DESCUENTO_COMPRA_CODIGO,
        M.COMPRA_NUMERO
FROM  gd_esquema.Maestra M 
WHERE M.DESCUENTO_COMPRA_CODIGO IS NOT NULL AND M.COMPRA_NUMERO IS NOT NULL 

DECLARE @CANTIDAD_REGISTROS NVARCHAR(255)
SET @CANTIDAD_REGISTROS = (SELECT COUNT(*) FROM HARAKIRI.DESCUENTO_COMPRA)
PRINT('Datos migrados a la tabla HARAKIRI.DESCUENTO_COMPRA. Nuevas filas: ' + @CANTIDAD_REGISTROS)

END
GO



GO
CREATE PROCEDURE HARAKIRI.RELLENAR_TABLA_COMPRA_POR_PRODUCTO
AS
BEGIN
INSERT INTO HARAKIRI.COMPRA_POR_PRODUCTO (PRODUCTO_VARIANTE_CODIGO, COMPRA_NUMERO, PRODUCTO_PRECIO_TOTAL, PRODUCTO_CANTIDAD  )
SELECT DISTINCT 
        M.COMPRA_POR_PRODUCTO_CODIGO,
        M.PRODUCTO_VARIANTE_CODIGO,
        M.COMPRA_NUMERO
FROM  gd_esquema.Maestra M 
WHERE M.COMPRA_POR_PRODUCTO_CODIGO IS NOT NULL AND M.PRODUCTO_VARIANTE_CODIGO IS NOT NULL AND M.COMPRA_NUMERO IS NOT NULL

DECLARE @CANTIDAD_REGISTROS NVARCHAR(255)
SET @CANTIDAD_REGISTROS = (SELECT COUNT(*) FROM HARAKIRI.COMPRA_POR_PRODUCTO)
PRINT('Datos migrados a la tabla HARAKIRI.COMPRA_POR_PRODUCTO. Nuevas filas: ' + @CANTIDAD_REGISTROS)

END
GO



GO
CREATE PROCEDURE HARAKIRI.RELLENAR_TABLA_VENTA
AS
BEGIN
INSERT INTO HARAKIRI.VENTA (VENTA_CANAL_CODIGO, VENTA_CUPON_CODIGO, VENTA_MEDIO_DE_PAGO_CODIGO, VENTA_CLIENTE_CODIGO, VENTA_MEDIO_ENVIO_POR_LOCALIDAD_CODIGO, VENTA_FECHA, VENTA_TOTAL )
SELECT DISTINCT 
        M.VENTA_CODIGO,
        M.VENTA_CANAL_CODIGO,
        M.VENTA_CUPON_CODIGO, 
        M.VENTA_MEDIO_DE_PAGO_CODIGO,
        M.VENTA_CLIENTE_CODIGO, 
        M.VENTA_MEDIO_ENVIO_POR_LOCALIDAD_CODIGO
FROM  gd_esquema.Maestra M 
WHERE M.VENTA_CODIGO IS NOT NULL AND M.VENTA_CANAL_CODIGO IS NOT NULL AND M.VENTA_CUPON_CODIGO IS NOT NULL AND M.VENTA_MEDIO_DE_PAGO_CODIGO IS NOT NULL AND M.VENTA_CLIENTE_CODIGO IS NOT NULL AND M.VENTA_MEDIO_ENVIO_POR_LOCALIDAD_CODIGO IS NOT NULL

DECLARE @CANTIDAD_REGISTROS NVARCHAR(255)
SET @CANTIDAD_REGISTROS = (SELECT COUNT(*) FROM HARAKIRI.VENTA)
PRINT('Datos migrados a la tabla HARAKIRI.VENTA. Nuevas filas: ' + @CANTIDAD_REGISTROS)

END
GO





EXEC  HARAKIRI.RELLENAR_TABLA_DESCUENTO_COMPRA
EXEC  HARAKIRI.RELLENAR_TABLA_COMPRA_POR_PRODUCTO
EXEC  HARAKIRI.RELLENAR_TABLA_VENTA

---FINAL SAMU